<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Topolop DEVELOPER-VIEW - 3D Codebase Explorer</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000;
            overflow: hidden;
        }

        #canvas-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 8px;
            min-width: 300px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .control-section {
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 15px;
        }

        .control-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .control-section h3 {
            margin: 0 0 10px 0;
            color: #4a9eff;
            font-size: 16px;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
            color: #ccc;
        }

        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        .control-group input[type="checkbox"] {
            margin-right: 8px;
        }

        .control-group input[type="color"] {
            width: 50px;
            height: 30px;
            border: none;
            border-radius: 4px;
            margin-right: 10px;
        }

        .control-row {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        .button {
            background: #4a9eff;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 5px;
            margin-bottom: 5px;
            font-size: 11px;
        }

        .button:hover {
            background: #357abd;
        }

        .button.secondary {
            background: #666;
        }

        .button.secondary:hover {
            background: #555;
        }

        .stats {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 200px;
        }

        .stats h3 {
            margin: 0 0 10px 0;
            color: #4a9eff;
            font-size: 16px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 12px;
        }

        .stat-value {
            color: #4a9eff;
            font-weight: bold;
        }

        .developer-notice {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 165, 0, 0.9);
            color: #000;
            padding: 20px;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            z-index: 1000;
            border: 2px solid #ff8c00;
        }

        .developer-notice h2 {
            margin-top: 0;
            color: #8B4513;
        }

        .close-notice {
            background: #8B4513;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        .close-notice:hover {
            background: #654321;
        }

        .hidden {
            display: none;
        }

        /* Camera and Movement Instructions */
        .help-overlay {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 300px;
        }

        .help-overlay h4 {
            margin: 0 0 10px 0;
            color: #4a9eff;
            font-size: 14px;
        }

        .help-overlay ul {
            margin: 0;
            padding-left: 20px;
            font-size: 12px;
            line-height: 1.4;
        }

        .help-overlay li {
            margin-bottom: 3px;
        }
    </style>
</head>
<body>
    <div id="canvas-container">
        <!-- Developer Notice Overlay -->
        <div class="developer-notice" id="developerNotice">
            <h2>üîß DEVELOPER-VIEW Template</h2>
            <p>This is the development template with advanced controls and debugging features.</p>
            <p>Use this for testing, feature development, and comprehensive analysis.</p>
            <p><strong>For production use, switch to MAIN-TEMPLATE.html</strong></p>
            <button class="close-notice" onclick="closeDeveloperNotice()">Got it! Close Notice</button>
        </div>

        <!-- Stats Panel -->
        <div class="stats">
            <h3>üìä Scene Statistics</h3>
            <div class="stat-item">
                <span>Buildings:</span>
                <span class="stat-value" id="buildingCount">0</span>
            </div>
            <div class="stat-item">
                <span>Rendered Objects:</span>
                <span class="stat-value" id="objectCount">0</span>
            </div>
            <div class="stat-item">
                <span>Draw Calls:</span>
                <span class="stat-value" id="drawCalls">0</span>
            </div>
            <div class="stat-item">
                <span>Triangles:</span>
                <span class="stat-value" id="triangleCount">0</span>
            </div>
            <div class="stat-item">
                <span>FPS:</span>
                <span class="stat-value" id="fpsCounter">60</span>
            </div>
        </div>

        <!-- Camera Help -->
        <div class="help-overlay">
            <h4>üéÆ Camera Controls</h4>
            <ul>
                <li><strong>WASD:</strong> Move camera</li>
                <li><strong>Mouse:</strong> Look around</li>
                <li><strong>Scroll:</strong> Zoom in/out</li>
                <li><strong>Shift+Move:</strong> Faster movement</li>
                <li><strong>Click building:</strong> Select & inspect</li>
            </ul>
        </div>

        <!-- Control Panel -->
        <div class="controls">
            <div class="control-section">
                <h3>üéØ Template Mode</h3>
                <p style="font-size: 11px; color: #ffa500; margin: 0;">Developer View - Advanced Controls Active</p>
            </div>

            <div class="control-section">
                <h3>üìã Quick Actions</h3>
                <button class="button" onclick="resetCamera()">üè† Reset Camera</button>
                <button class="button" onclick="centerOnBuildings()">üéØ Center View</button>
                <button class="button secondary" onclick="exportScene()">üíæ Export Data</button>
                <button class="button secondary" onclick="debugMode()">üêõ Debug Mode</button>
            </div>

            <div class="control-section">
                <h3>‚ö° Performance</h3>
                <div class="control-group">
                    <label>Render Quality:</label>
                    <select id="renderQuality" onchange="setRenderQuality(this.value)">
                        <option value="high">High (1.0x)</option>
                        <option value="medium" selected>Medium (0.8x)</option>
                        <option value="low">Low (0.6x)</option>
                        <option value="ultra-low">Ultra Low (0.4x)</option>
                    </select>
                </div>
                <div class="control-group">
                    <div class="control-row">
                        <input type="checkbox" id="enableShadows" checked onchange="toggleShadows(this.checked)">
                        <label for="enableShadows">Enable Shadows</label>
                    </div>
                </div>
                <div class="control-group">
                    <div class="control-row">
                        <input type="checkbox" id="enableAntialiasing" checked onchange="toggleAntialiasing(this.checked)">
                        <label for="enableAntialiasing">Enable Antialiasing</label>
                    </div>
                </div>
            </div>

            <div class="control-section">
                <h3>üéÆ Movement Speed</h3>
                <div class="control-group">
                    <label>Movement: <span id="moveSpeedValue">5</span></label>
                    <input type="range" id="moveSpeedSlider" min="1" max="20" value="5" step="0.5" oninput="adjustMoveSpeed(this.value)">
                </div>
                <div class="control-group">
                    <label>Zoom: <span id="zoomSpeedValue">1</span></label>
                    <input type="range" id="zoomSpeedSlider" min="0.2" max="3" value="1" step="0.1" oninput="adjustZoomSpeed(this.value)">
                </div>
                <div class="control-group">
                    <label>Rotation: <span id="rotationSpeedValue">1</span></label>
                    <input type="range" id="rotationSpeedSlider" min="0.2" max="3" value="1" step="0.1" oninput="adjustRotationSpeed(this.value)">
                </div>
            </div>

            <div class="control-section">
                <h3>üí° Environment</h3>
                <div class="control-group">
                    <label>Background Color:</label>
                    <input type="color" id="backgroundColor" value="#000614" onchange="setBackgroundColor(this.value)">
                </div>
                <div class="control-group">
                    <label>Ambient Light: <span id="ambientValue">0.4</span></label>
                    <input type="range" id="ambientSlider" min="0" max="2" value="0.4" step="0.1" oninput="adjustLighting('ambient', this.value)">
                </div>
                <div class="control-group">
                    <label>Directional Light: <span id="directionalValue">0.8</span></label>
                    <input type="range" id="directionalSlider" min="0" max="2" value="0.8" step="0.1" oninput="adjustLighting('directional', this.value)">
                </div>
                <div class="control-group">
                    <div class="control-row">
                        <input type="checkbox" id="enableFog" checked onchange="toggleFog(this.checked)">
                        <label for="enableFog">Enable Fog</label>
                    </div>
                </div>
            </div>

            <div class="control-section">
                <h3>üîç Building Analysis</h3>
                <div class="control-group">
                    <label>Building Height Scale:</label>
                    <input type="range" id="heightScale" min="0.1" max="3" value="1" step="0.1" onchange="adjustBuildingScale(this.value)">
                </div>
                <div class="control-group">
                    <div class="control-row">
                        <input type="checkbox" id="showLabels" checked onchange="toggleLabels(this.checked)">
                        <label for="showLabels">Show Labels</label>
                    </div>
                </div>
                <div class="control-group">
                    <div class="control-row">
                        <input type="checkbox" id="showConnections" onchange="toggleConnections(this.checked)">
                        <label for="showConnections">Show Dependencies</label>
                    </div>
                </div>
            </div>

            <div class="control-section">
                <h3>üé® Visual Modes</h3>
                <div class="control-group">
                    <label>Color Mode:</label>
                    <select id="colorMode" onchange="setColorMode(this.value)">
                        <option value="file-type" selected>File Type</option>
                        <option value="size">File Size</option>
                        <option value="complexity">Complexity</option>
                        <option value="dependencies">Dependencies</option>
                        <option value="risk">Risk Level</option>
                    </select>
                </div>
                <div class="control-group">
                    <div class="control-row">
                        <input type="checkbox" id="wireframeMode" onchange="toggleWireframe(this.checked)">
                        <label for="wireframeMode">Wireframe Mode</label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        // Three.js scene setup
        let scene, camera, renderer, controls;
        let buildings = [];
        let selectedBuilding = null;
        
        // Movement controls
        const keys = { w: false, a: false, s: false, d: false };
        let moveSpeed = 5;
        let zoomSpeed = 1;
        let rotationSpeed = 1;

        // Performance monitoring
        let frameCount = 0;
        let lastTime = performance.now();

        // Developer features
        let debugMode = false;
        let renderStats = { objects: 0, triangles: 0, drawCalls: 0 };

        function init() {
            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000614);

            // Camera setup
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(40, 30, 40);

            // Renderer setup
            renderer = new THREE.WebGLRenderer({ 
                antialias: true,
                alpha: true,
                powerPreference: "high-performance"
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000614, 1);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // Controls setup
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.rotateSpeed = 0.5;
            controls.zoomSpeed = 0.8;
            controls.panSpeed = 0.3;

            // Lighting setup
            setupLighting();

            // Load data and create buildings
            loadBuildingData();

            // Event listeners
            setupEventListeners();

            // Start animation loop
            animate();

            console.log('üîß DEVELOPER-VIEW Template Initialized');
        }

        function setupLighting() {
            // Ambient light
            const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
            ambientLight.name = 'ambientLight';
            scene.add(ambientLight);

            // Directional light (sun)
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(50, 100, 50);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            directionalLight.name = 'directionalLight';
            scene.add(directionalLight);

            // Fog
            scene.fog = new THREE.Fog(0x000614, 100, 300);
        }

        function loadBuildingData() {
            // Try to load enhanced aggregated data first, fallback to main template data
            const dataUrl = '../examples/results/enhanced-aggregated-3d-data.json';
            
            fetch(dataUrl)
                .then(response => response.json())
                .then(data => {
                    console.log(`üèóÔ∏è Loaded ${data.length} buildings for DEVELOPER-VIEW`);
                    createBuildings(data);
                    updateStatistics();
                })
                .catch(error => {
                    console.warn('Failed to load enhanced data, trying fallback:', error);
                    // Fallback to unified city data
                    return fetch('../../data/unified-city-data-export.json');
                })
                .then(response => response ? response.json() : null)
                .then(data => {
                    if (data) {
                        console.log(`üèóÔ∏è Loaded ${data.length} buildings (fallback data)`);
                        createBuildings(data);
                        updateStatistics();
                    }
                })
                .catch(error => {
                    console.error('Failed to load any building data:', error);
                    // Create sample data for testing
                    createSampleBuildings();
                });
        }

        function createBuildings(data) {
            buildings = [];
            
            data.forEach((building, index) => {
                const geometry = new THREE.BoxGeometry(
                    building.width || 2,
                    building.height || 3,
                    building.depth || 2
                );

                // Create material based on file type
                const material = createBuildingMaterial(building);
                
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.set(
                    building.x || index * 3,
                    (building.height || 3) / 2,
                    building.z || 0
                );
                
                mesh.castShadow = true;
                mesh.receiveShadow = true;
                mesh.userData = building;
                
                scene.add(mesh);
                buildings.push(mesh);
            });

            console.log(`üè¢ Created ${buildings.length} buildings`);
        }

        function createBuildingMaterial(building) {
            // Base color by file type or risk level
            let baseColor = 0x4a9eff; // Default blue
            
            if (building.fileType) {
                switch (building.fileType.toLowerCase()) {
                    case 'javascript': baseColor = 0xf7df1e; break;
                    case 'typescript': baseColor = 0x3178c6; break;
                    case 'python': baseColor = 0x3776ab; break;
                    case 'java': baseColor = 0xed8b00; break;
                    case 'css': baseColor = 0x1572b6; break;
                    case 'html': baseColor = 0xe34f26; break;
                    case 'json': baseColor = 0x000000; break;
                    case 'markdown': baseColor = 0x083fa1; break;
                }
            }

            // Adjust color based on risk or complexity
            if (building.riskLevel) {
                switch (building.riskLevel.toLowerCase()) {
                    case 'critical': baseColor = 0xff0000; break;
                    case 'high': baseColor = 0xff6600; break;
                    case 'medium': baseColor = 0xffff00; break;
                    case 'low': baseColor = 0x00ff00; break;
                }
            }

            return new THREE.MeshLambertMaterial({ 
                color: baseColor,
                transparent: true,
                opacity: 0.9
            });
        }

        function createSampleBuildings() {
            console.log('üß™ Creating sample buildings for testing');
            const sampleData = Array.from({ length: 20 }, (_, i) => ({
                id: `sample-${i}`,
                name: `Sample Building ${i + 1}`,
                x: (i % 5) * 8 - 16,
                z: Math.floor(i / 5) * 8 - 12,
                width: 2 + Math.random() * 2,
                height: 2 + Math.random() * 8,
                depth: 2 + Math.random() * 2,
                fileType: ['javascript', 'typescript', 'python', 'java', 'css'][Math.floor(Math.random() * 5)],
                riskLevel: ['low', 'medium', 'high', 'critical'][Math.floor(Math.random() * 4)]
            }));
            
            createBuildings(sampleData);
            updateStatistics();
        }

        function setupEventListeners() {
            // Keyboard controls
            document.addEventListener('keydown', (event) => {
                switch(event.code) {
                    case 'KeyW': keys.w = true; break;
                    case 'KeyA': keys.a = true; break;
                    case 'KeyS': keys.s = true; break;
                    case 'KeyD': keys.d = true; break;
                }
            });

            document.addEventListener('keyup', (event) => {
                switch(event.code) {
                    case 'KeyW': keys.w = false; break;
                    case 'KeyA': keys.a = false; break;
                    case 'KeyS': keys.s = false; break;
                    case 'KeyD': keys.d = false; break;
                }
            });

            // Window resize
            window.addEventListener('resize', onWindowResize);

            // Mouse interactions
            renderer.domElement.addEventListener('click', onBuildingClick);
        }

        function updateMovement() {
            if (!(keys.w || keys.a || keys.s || keys.d)) return;
            
            // Camera-relative WASD movement (RTS-style)
            const forward = new THREE.Vector3();
            camera.getWorldDirection(forward);
            const right = new THREE.Vector3();
            right.crossVectors(camera.up, forward);
            
            // Flatten vectors to horizontal plane (ignore Y component)
            const flatForward = new THREE.Vector3(forward.x, 0, forward.z).normalize();
            const flatRight = new THREE.Vector3(right.x, 0, right.z).normalize();
            
            const moveVector = new THREE.Vector3();
            
            if (keys.w) moveVector.add(flatForward);
            if (keys.s) moveVector.sub(flatForward);
            if (keys.d) moveVector.add(flatRight);
            if (keys.a) moveVector.sub(flatRight);
            
            if (moveVector.length() > 0) {
                moveVector.normalize();
                moveVector.multiplyScalar(moveSpeed * 0.16); // 60fps normalized
                
                camera.position.add(moveVector);
                controls.target.add(moveVector);
                controls.update();
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            
            updateMovement();
            controls.update();
            
            // Update performance stats
            updatePerformanceStats();
            
            renderer.render(scene, camera);
        }

        function updatePerformanceStats() {
            frameCount++;
            const currentTime = performance.now();
            
            if (currentTime >= lastTime + 1000) {
                const fps = Math.round((frameCount * 1000) / (currentTime - lastTime));
                document.getElementById('fpsCounter').textContent = fps;
                
                frameCount = 0;
                lastTime = currentTime;
            }
        }

        function updateStatistics() {
            document.getElementById('buildingCount').textContent = buildings.length;
            document.getElementById('objectCount').textContent = scene.children.length;
            document.getElementById('triangleCount').textContent = calculateTriangleCount();
        }

        function calculateTriangleCount() {
            let triangles = 0;
            scene.traverse((child) => {
                if (child.geometry) {
                    triangles += child.geometry.attributes.position.count / 3;
                }
            });
            return Math.round(triangles);
        }

        // Control Functions
        function closeDeveloperNotice() {
            document.getElementById('developerNotice').style.display = 'none';
        }

        function resetCamera() {
            camera.position.set(40, 30, 40);
            controls.target.set(0, 0, 0);
            controls.update();
        }

        function centerOnBuildings() {
            if (buildings.length === 0) return;
            
            const box = new THREE.Box3();
            buildings.forEach(building => box.expandByObject(building));
            
            const center = box.getCenter(new THREE.Vector3());
            const size = box.getSize(new THREE.Vector3());
            
            const maxSize = Math.max(size.x, size.y, size.z);
            const distance = maxSize * 2;
            
            camera.position.copy(center);
            camera.position.y += distance * 0.5;
            camera.position.z += distance * 0.8;
            
            controls.target.copy(center);
            controls.update();
        }

        function exportScene() {
            const sceneData = {
                buildings: buildings.map(b => b.userData),
                camera: {
                    position: camera.position,
                    target: controls.target
                },
                timestamp: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(sceneData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'topolop-scene-export.json';
            link.click();
            
            console.log('üìÅ Scene exported successfully');
        }

        function debugMode() {
            debugMode = !debugMode;
            
            if (debugMode) {
                // Add axis helper
                const axesHelper = new THREE.AxesHelper(20);
                axesHelper.name = 'debugAxes';
                scene.add(axesHelper);
                
                // Add grid helper
                const gridHelper = new THREE.GridHelper(100, 20);
                gridHelper.name = 'debugGrid';
                scene.add(gridHelper);
                
                console.log('üêõ Debug mode enabled');
            } else {
                // Remove debug helpers
                const axes = scene.getObjectByName('debugAxes');
                const grid = scene.getObjectByName('debugGrid');
                if (axes) scene.remove(axes);
                if (grid) scene.remove(grid);
                
                console.log('üêõ Debug mode disabled');
            }
        }

        // Speed Control Functions
        function adjustMoveSpeed(value) {
            moveSpeed = parseFloat(value);
            document.getElementById('moveSpeedValue').textContent = value;
            updateControlSpeeds();
        }

        function adjustZoomSpeed(value) {
            zoomSpeed = parseFloat(value);
            document.getElementById('zoomSpeedValue').textContent = value;
            updateControlSpeeds();
        }

        function adjustRotationSpeed(value) {
            rotationSpeed = parseFloat(value);
            document.getElementById('rotationSpeedValue').textContent = value;
            updateControlSpeeds();
        }

        function updateControlSpeeds() {
            controls.rotateSpeed = rotationSpeed * 0.5;
            controls.zoomSpeed = zoomSpeed * 0.8;
            controls.panSpeed = moveSpeed * 0.3;
        }

        // Environment Controls
        function setBackgroundColor(color) {
            const threeColor = new THREE.Color(color);
            scene.background = threeColor;
            if (scene.fog) scene.fog.color = threeColor;
        }

        function adjustLighting(type, value) {
            const intensity = parseFloat(value);
            document.getElementById(`${type}Value`).textContent = value;
            
            const light = scene.getObjectByName(`${type}Light`);
            if (light) light.intensity = intensity;
        }

        function toggleFog(enabled) {
            if (enabled) {
                scene.fog = new THREE.Fog(scene.background, 100, 300);
            } else {
                scene.fog = null;
            }
        }

        function toggleShadows(enabled) {
            renderer.shadowMap.enabled = enabled;
            buildings.forEach(building => {
                building.castShadow = enabled;
                building.receiveShadow = enabled;
            });
        }

        function toggleAntialiasing(enabled) {
            // Note: This requires renderer recreation in practice
            console.log('Antialiasing toggle:', enabled);
        }

        function setRenderQuality(quality) {
            const qualityMap = {
                'ultra-low': 0.4,
                'low': 0.6,
                'medium': 0.8,
                'high': 1.0
            };
            
            const scale = qualityMap[quality] || 0.8;
            renderer.setPixelRatio(window.devicePixelRatio * scale);
            console.log('Render quality set to:', quality, 'Scale:', scale);
        }

        function adjustBuildingScale(scale) {
            buildings.forEach(building => {
                building.scale.y = parseFloat(scale);
                building.position.y = (building.geometry.parameters.height * scale) / 2;
            });
        }

        function toggleLabels(enabled) {
            console.log('Labels toggle:', enabled);
            // Label implementation would go here
        }

        function toggleConnections(enabled) {
            console.log('Connections toggle:', enabled);
            // Connection visualization would go here
        }

        function setColorMode(mode) {
            buildings.forEach(building => {
                const newMaterial = createBuildingMaterial(building.userData);
                building.material = newMaterial;
            });
            console.log('Color mode set to:', mode);
        }

        function toggleWireframe(enabled) {
            buildings.forEach(building => {
                building.material.wireframe = enabled;
            });
        }

        function onBuildingClick(event) {
            const mouse = new THREE.Vector2();
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(mouse, camera);

            const intersects = raycaster.intersectObjects(buildings);
            
            if (intersects.length > 0) {
                const building = intersects[0].object;
                console.log('üè¢ Selected building:', building.userData);
                selectedBuilding = building;
                
                // Highlight selected building
                buildings.forEach(b => b.material.emissive.setHex(0x000000));
                building.material.emissive.setHex(0x444444);
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // Initialize the application
        init();
    </script>
</body>
</html>